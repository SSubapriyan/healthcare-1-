<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Cloud Healthcare System – Demo</title>
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- React 18 CDN -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script crossorigin src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  
  <style>
    html, body, #root { height: 100%; }
    .card { @apply bg-white rounded-2xl shadow p-5; }
    .btn { @apply inline-flex items-center justify-center rounded-xl px-4 py-2 font-medium shadow; }
    .btn-primary { @apply bg-blue-600 text-white hover:bg-blue-700; }
    .btn-ghost { @apply hover:bg-gray-100; }
    .input { @apply w-full rounded-xl border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500; }
    .badge { @apply inline-flex items-center rounded-full px-2 py-0.5 text-xs font-semibold bg-blue-100 text-blue-700; }
  </style>
</head>
<body class="bg-gray-50 text-gray-900">
  <div id="root"></div>

  <script type="text/babel">
    const { useEffect, useMemo, useRef, useState } = React;

    // ---------------------------------------------
    // Minimal Hash Router
    // ---------------------------------------------
    function useHashRoute() {
      const [route, setRoute] = useState(window.location.hash.replace('#','') || 'login');
      useEffect(() => {
        const onHash = () => setRoute(window.location.hash.replace('#','') || 'login');
        window.addEventListener('hashchange', onHash);
        return () => window.removeEventListener('hashchange', onHash);
      }, []);
      const navigate = (to) => { window.location.hash = to; };
      return [route, navigate];
    }

    // ---------------------------------------------
    // Mock Auth & Storage
    // ---------------------------------------------
    const Storage = {
      load(key, fallback) {
        try { return JSON.parse(localStorage.getItem(key)) ?? fallback; } catch { return fallback; }
      },
      save(key, value) { localStorage.setItem(key, JSON.stringify(value)); }
    };

    // Seed sample patients on first run
    if (!localStorage.getItem('patients')) {
      Storage.save('patients', [
        { id: 'P-1001', name: 'John Doe', age: 45, condition: 'Type-2 Diabetes', lastUpdated: new Date().toISOString() },
        { id: 'P-1002', name: 'Alice Smith', age: 30, condition: 'Hypertension', lastUpdated: new Date().toISOString() },
        { id: 'P-1003', name: 'Ravi Kumar', age: 54, condition: 'Arrhythmia', lastUpdated: new Date().toISOString() }
      ]);
    }

    // ---------------------------------------------
    // UI Primitives
    // ---------------------------------------------
    const Card = ({children, className=''}) => (
      <div className={`bg-white rounded-2xl shadow p-5 ${className}`}>{children}</div>
    );

    const Stat = ({label, value, hint}) => (
      <div className="card">
        <div className="text-sm text-gray-500">{label}</div>
        <div className="text-2xl font-bold mt-1">{value}</div>
        {hint && <div className="text-xs text-gray-400 mt-1">{hint}</div>}
      </div>
    );

    const Topbar = ({ onLogout }) => (
      <header className="sticky top-0 z-30 bg-white/80 backdrop-blur border-b">
        <div className="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between">
          <div className="flex items-center gap-3">
            <div className="h-9 w-9 grid place-items-center rounded-xl bg-blue-600 text-white font-bold">CH</div>
            <div>
              <div className="font-semibold">Cloud Healthcare</div>
              <div className="text-xs text-gray-500">Secure · AI-ready · Real-time</div>
            </div>
          </div>
          <nav className="hidden md:flex items-center gap-1">
            <a className="btn btn-ghost" href="#dashboard">Dashboard</a>
            <a className="btn btn-ghost" href="#upload">Upload</a>
            <a className="btn btn-ghost" href="#ai">AI Results</a>
            <a className="btn btn-ghost" href="#monitoring">Monitoring</a>
          </nav>
          <button className="btn btn-primary" onClick={onLogout}>Logout</button>
        </div>
      </header>
    );

    // ---------------------------------------------
    // Pages
    // ---------------------------------------------
    function LoginPage({ onLogin }) {
      const [email, setEmail] = useState('ssubapriyan@gmail.com');
      const [password, setPassword] = useState('kgkite');
      const [show, setShow] = useState(false);
      const handleSubmit = (e) => {
        e.preventDefault();
        if(!email || !password) return alert('Please enter email & password');
        // Mock: accept any credentials, but store doctor profile
        Storage.save('doctor', { email, name: email.split('@')[0] });
        onLogin();
        window.location.hash = 'dashboard';
      };

      return (
        <div className="min-h-screen grid place-items-center px-4">
          <Card className="w-full max-w-md">
            <h1 className="text-2xl font-bold">Doctor Login</h1>
            <p className="text-sm text-gray-500 mt-1">Secure access with TLS/SSL · OAuth-ready UI</p>
            <form className="mt-6 space-y-4" onSubmit={handleSubmit}>
              <div>
                <label className="text-sm">Email</label>
                <input className="input mt-1" type="email" placeholder="doctor@hospital.com" value={email} onChange={(e)=>setEmail(e.target.value)} />
              </div>
              <div>
                <label className="text-sm">Password</label>
                <div className="relative mt-1">
                  <input className="input pr-10" type={show? 'text':'password'} placeholder="••••••••" value={password} onChange={(e)=>setPassword(e.target.value)} />
                  <button type="button" className="absolute right-2 top-1/2 -translate-y-1/2 text-sm text-gray-500" onClick={()=>setShow(s=>!s)}>{show? 'Hide':'Show'}</button>
                </div>
              </div>
              <button className="btn btn-primary w-full" type="submit">Login</button>
            </form>
            <div className="text-xs text-gray-400 mt-4">
              Demo only. Integrate real auth via OAuth 2.0 / SSO / JWT with your backend.
            </div>
          </Card>
        </div>
      );
    }

    function DashboardPage() {
      const [query, setQuery] = useState('');
      const [patients, setPatients] = useState(() => Storage.load('patients', []));

      const filtered = useMemo(() => {
        const q = query.toLowerCase();
        return patients.filter(p => [p.id, p.name, p.condition].join(' ').toLowerCase().includes(q));
      }, [patients, query]);

      const addPatient = () => {
        const id = `P-${Math.floor(1000 + Math.random()*9000)}`;
        const name = prompt('Patient name?');
        if(!name) return;
        const age = +prompt('Age?') || 40;
        const condition = prompt('Primary condition?') || 'General';
        const next = { id, name, age, condition, lastUpdated: new Date().toISOString() };
        const all = [next, ...patients];
        setPatients(all);
        Storage.save('patients', all);
      };

      return (
        <div className="mx-auto max-w-7xl p-4 sm:p-6 space-y-6">
          <div className="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4">
            <div>
              <h2 className="text-2xl font-bold">Patient Records</h2>
              <p className="text-sm text-gray-500">Centralized cloud-ready directory</p>
            </div>
            <div className="flex gap-2 w-full sm:w-auto">
              <input className="input" placeholder="Search patients..." value={query} onChange={(e)=>setQuery(e.target.value)} />
              <button className="btn btn-primary" onClick={addPatient}>Add Patient</button>
            </div>
          </div>

          <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
            <Stat label="Total Patients" value={patients.length} />
            <Stat label="AI Flags (24h)" value={Math.floor(patients.length*0.2)+1} hint="Potential risks to review" />
            <Stat label="Reports Uploaded" value={Storage.load('uploads', []).length} />
            <Stat label="Uptime" value="99.98%" hint="Cloud SLA (demo)" />
          </div>

          <Card>
            <div className="overflow-x-auto">
              <table className="min-w-full text-sm">
                <thead className="bg-gray-100 text-gray-700">
                  <tr>
                    <th className="px-3 py-2 text-left">ID</th>
                    <th className="px-3 py-2 text-left">Name</th>
                    <th className="px-3 py-2">Age</th>
                    <th className="px-3 py-2 text-left">Condition</th>
                    <th className="px-3 py-2 text-left">Last Updated</th>
                    <th className="px-3 py-2 text-right">Action</th>
                  </tr>
                </thead>
                <tbody>
                  {filtered.map(p => (
                    <tr key={p.id} className="border-t">
                      <td className="px-3 py-2 font-mono">{p.id}</td>
                      <td className="px-3 py-2">{p.name}</td>
                      <td className="px-3 py-2 text-center">{p.age}</td>
                      <td className="px-3 py-2">
                        <span className="badge">{p.condition}</span>
                      </td>
                      <td className="px-3 py-2 text-gray-500">{new Date(p.lastUpdated).toLocaleString()}</td>
                      <td className="px-3 py-2 text-right">
                        <a className="text-blue-600 hover:underline" href={`#upload?patient=${encodeURIComponent(p.id)}`}>Upload</a>
                      </td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
          </Card>
        </div>
      );
    }

    function UploadPage() {
      const [patientId, setPatientId] = useState(() => new URLSearchParams(location.hash.split('?')[1]).get('patient') || '');
      const [file, setFile] = useState(null);
      const [type, setType] = useState('MRI');
      const [notes, setNotes] = useState('');

      const patients = Storage.load('patients', []);

      const onSubmit = (e) => {
        e.preventDefault();
        if(!patientId || !file) return alert('Select a patient and a file.');
        const record = {
          id: 'U-' + Math.random().toString(36).slice(2,8).toUpperCase(),
          patientId,
          fileName: file.name,
          mime: file.type || 'application/octet-stream',
          sizeKB: Math.round(file.size/1024),
          type,
          notes,
          ts: new Date().toISOString()
        };
        const uploads = Storage.load('uploads', []);
        uploads.unshift(record);
        Storage.save('uploads', uploads);
        alert('Upload stored locally (demo). Connect to S3/GCS in production.');
        window.location.hash = 'ai';
      };

      return (
        <div className="mx-auto max-w-3xl p-4 sm:p-6 space-y-6">
          <div>
            <h2 className="text-2xl font-bold">Upload Medical Report</h2>
            <p className="text-sm text-gray-500">Stores metadata locally. Replace with cloud SDK calls for S3 / GCS.</p>
          </div>
          <Card>
            <form className="space-y-4" onSubmit={onSubmit}>
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                  <label className="text-sm">Patient</label>
                  <select className="input mt-1" value={patientId} onChange={(e)=>setPatientId(e.target.value)}>
                    <option value="">Select patient</option>
                    {patients.map(p=> (
                      <option key={p.id} value={p.id}>{p.id} — {p.name}</option>
                    ))}
                  </select>
                </div>
                <div>
                  <label className="text-sm">Report Type</label>
                  <select className="input mt-1" value={type} onChange={(e)=>setType(e.target.value)}>
                    {['MRI','X-Ray','CT','ECG','Lab Report'].map(t=> <option key={t}>{t}</option>)}
                  </select>
                </div>
              </div>
              <div>
                <label className="text-sm">File</label>
                <input className="input mt-1" type="file" onChange={(e)=>setFile(e.target.files?.[0]||null)} />
                {file && <div className="text-xs text-gray-500 mt-1">{file.name} · {(file.size/1024/1024).toFixed(2)} MB</div>}
              </div>
              <div>
                <label className="text-sm">Clinical Notes (optional)</label>
                <textarea className="input mt-1 h-28" placeholder="Symptoms, observations, etc." value={notes} onChange={(e)=>setNotes(e.target.value)} />
              </div>
              <div className="flex justify-end gap-2">
                <a className="btn btn-ghost" href="#dashboard">Cancel</a>
                <button className="btn btn-primary" type="submit">Save & Analyze</button>
              </div>
            </form>
          </Card>

          <Card>
            <h3 className="font-semibold mb-3">Recent Uploads</h3>
            <UploadsTable uploads={Storage.load('uploads', [])} compact />
          </Card>
        </div>
      );
    }

    function UploadsTable({ uploads, compact=false }) {
      if (!uploads.length) return <div className="text-sm text-gray-500">No uploads yet.</div>;
      return (
        <div className="overflow-x-auto">
          <table className="min-w-full text-sm">
            <thead className="bg-gray-100 text-gray-700">
              <tr>
                <th className="px-3 py-2 text-left">Upload ID</th>
                <th className="px-3 py-2 text-left">Patient</th>
                <th className="px-3 py-2 text-left">Type</th>
                <th className="px-3 py-2 text-left">File</th>
                {!compact && <th className="px-3 py-2 text-left">Notes</th>}
                <th className="px-3 py-2 text-left">Time</th>
              </tr>
            </thead>
            <tbody>
              {uploads.map(u => (
                <tr key={u.id} className="border-t">
                  <td className="px-3 py-2 font-mono">{u.id}</td>
                  <td className="px-3 py-2">{u.patientId}</td>
                  <td className="px-3 py-2">{u.type}</td>
                  <td className="px-3 py-2">{u.fileName} <span className="text-gray-400">({u.sizeKB} KB)</span></td>
                  {!compact && <td className="px-3 py-2">{u.notes || '-'}</td>}
                  <td className="px-3 py-2 text-gray-500">{new Date(u.ts).toLocaleString()}</td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>
      );
    }

    function AIResultsPage() {
      const uploads = Storage.load('uploads', []);
      const [selected, setSelected] = useState(uploads[0]?.id || '');
      const record = uploads.find(u => u.id === selected);

      // Demo AI inference (mock) – deterministic-ish based on ID
      const ai = useMemo(() => {
        if (!record) return null;
        const seed = record.id.split('').reduce((a,c)=>a+c.charCodeAt(0),0);
        const risk = ['Low','Moderate','High'][seed % 3];
        const findings = [
          'No acute intracranial hemorrhage detected',
          'Mild left-ventricular hypertrophy pattern observed',
          'Suspicious nodule ~6mm; recommend follow-up in 3 months',
          'Sinus rhythm irregularities consistent with PVCs',
          'Degenerative changes at L4-L5 with mild canal narrowing'
        ];
        const top3 = [findings[seed%5], findings[(seed+1)%5], findings[(seed+2)%5]];
        const confidence = 72 + (seed % 21); // 72–92%
        return { risk, top3, confidence };
      }, [record]);

      return (
        <div className="mx-auto max-w-5xl p-4 sm:p-6 space-y-6">
          <div className="flex items-start justify-between gap-4">
            <div>
              <h2 className="text-2xl font-bold">AI Diagnosis Results</h2>
              <p className="text-sm text-gray-500">Demo-only inference. Plug into Vertex AI / SageMaker.</p>
            </div>
            <a className="btn btn-ghost" href="#upload">New Analysis</a>
          </div>

          <Card>
            <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
              <div>
                <label className="text-sm">Select Upload</label>
                <select className="input mt-1" value={selected} onChange={(e)=>setSelected(e.target.value)}>
                  <option value="">Choose an upload</option>
                  {uploads.map(u => (
                    <option key={u.id} value={u.id}>{u.id} · {u.type} · {u.patientId}</option>
                  ))}
                </select>
              </div>
              <Stat label="Model Confidence" value={ai? ai.confidence + '%':'—'} />
              <Stat label="Risk Level" value={ai? ai.risk:'—'} />
            </div>
          </Card>

          {ai && (
            <Card>
              <h3 className="font-semibold mb-3">Key Findings</h3>
              <ul className="list-disc pl-6 text-sm space-y-1">
                {ai.top3.map((t,i)=>(<li key={i}>{t}</li>))}
              </ul>
              <div className="text-xs text-gray-400 mt-3">
                Not for clinical use. This demo only illustrates UI flow.
              </div>
            </Card>
          )}

          <Card>
            <h3 className="font-semibold mb-3">Recent Uploads</h3>
            <UploadsTable uploads={uploads} compact />
          </Card>
        </div>
      );
    }

    function MonitoringPage() {
      const [vitals, setVitals] = useState({ hr: 76, bp: '120/80', temp: 98.6, spo2: 98 });
      const [events, setEvents] = useState([]);

      useEffect(() => {
        const t = setInterval(() => {
          // Simple vitals drift for demo
          setVitals(v => ({
            hr: Math.max(50, Math.min(130, Math.round(v.hr + (Math.random()-0.5)*4))),
            bp: `${120 + Math.round((Math.random()-0.5)*6)}/${80 + Math.round((Math.random()-0.5)*4)}`,
            temp: +(v.temp + (Math.random()-0.5)*0.1).toFixed(1),
            spo2: Math.max(90, Math.min(100, v.spo2 + Math.round((Math.random()-0.5)*2)))
          }));
        }, 2000);
        return () => clearInterval(t);
      }, []);

      useEffect(() => {
        if (vitals.hr > 120 || vitals.spo2 < 92 || vitals.temp > 100.4) {
          setEvents((e) => [{ ts: new Date().toLocaleTimeString(), note: `Alert: HR ${vitals.hr}, SpO₂ ${vitals.spo2}%, Temp ${vitals.temp}°F` }, ...e].slice(0,8));
        }
      }, [vitals]);

      return (
        <div className="mx-auto max-w-6xl p-4 sm:p-6 space-y-6">
          <div className="flex items-start justify-between">
            <div>
              <h2 className="text-2xl font-bold">Real-time Monitoring</h2>
              <p className="text-sm text-gray-500">Simulated vitals stream. Replace with WebSocket/Server-Sent Events.</p>
            </div>
            <a className="btn btn-ghost" href="#dashboard">Back to Dashboard</a>
          </div>

          <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
            <Stat label="Heart Rate (bpm)" value={vitals.hr} />
            <Stat label="Blood Pressure" value={vitals.bp} />
            <Stat label="Temperature (°F)" value={vitals.temp} />
            <Stat label="SpO₂ (%)" value={vitals.spo2} />
          </div>

          <Card>
            <h3 className="font-semibold mb-3">Recent Alerts</h3>
            {events.length === 0 ? (
              <div className="text-sm text-gray-500">No alerts triggered yet.</div>
            ) : (
              <ul className="text-sm space-y-1">
                {events.map((e,i)=> <li key={i}>[{e.ts}] {e.note}</li>)}
              </ul>
            )}
          </Card>
        </div>
      );
    }

    // ---------------------------------------------
    // Shell
    // ---------------------------------------------
    function AppShell() {
      const [route] = useHashRoute();
      const [doctor, setDoctor] = useState(() => Storage.load('doctor', null));

      const logout = () => {
        localStorage.removeItem('doctor');
        setDoctor(null);
        window.location.hash = 'login';
      };

      if (!doctor) return <LoginPage onLogin={()=>setDoctor(Storage.load('doctor', null))} />;

      return (
        <div className="min-h-screen grid grid-rows-[auto,1fr]">
          <Topbar onLogout={logout} />
          <main>
            {route === 'dashboard' && <DashboardPage/>}
            {route === 'upload' && <UploadPage/>}
            {route === 'ai' && <AIResultsPage/>}
            {route === 'monitoring' && <MonitoringPage/>}
            {['login',''].includes(route) && <DashboardPage/>}
          </main>
          <footer className="mt-10 py-6 text-center text-xs text-gray-400">
            Demo UI · Frontend only · Replace stubs with: OAuth2/SSO · REST/GraphQL · Cloud Storage (S3/GCS) · AI endpoints (Vertex/SageMaker)
          </footer>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<AppShell/>);
  </script>
</body>
</html>
